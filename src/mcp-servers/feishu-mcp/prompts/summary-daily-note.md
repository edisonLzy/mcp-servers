# Daily Note Summary Workflow

## 概述
从Daily Note多维表格中提取当日记录，并由AI写作大师将零散的笔记内容转化为高质量的博客文章（涵盖技术、金融、AI、生活、法律等多个领域），最终保存为飞书文档。

## Context 信息

1. 使用固定的多维表格配置：
```json
{
  "app_token": "WGHcbBFFEaXV9qsZN6ecbCmCnfh",
  "table_id": "tbljmyT87cIlcMBz"
}
```

## 执行步骤

### 1. 获取表格字段信息
使用 `list-bitable-fields` 工具了解字段结构：
```
工具: list-bitable-fields
参数: {
  "app_token": "WGHcbBFFEaXV9qsZN6ecbCmCnfh",
  "table_id": "tbljmyT87cIlcMBz"
}
```

识别关键字段：
- 日期字段（可能名为"日期"、"Date"、"创建时间"等）
- 标题字段（可能名为"标题"、"Title"等）
- 内容字段（可能名为"内容"、"Content"、"描述"等）
- 分类字段（可能名为"分类"、"Category"、"类型"等）
- 标签字段（可能名为"标签"、"Tags"等）

**错误处理：**
- 如果无法获取字段信息：停止执行，告知用户"无法读取表格字段结构，错误信息：[具体错误]"
- 如果找不到日期相关字段：告知用户"未找到日期字段，请确认表格中是否有日期、Date或创建时间等字段。当前可用字段：[列出所有字段]"
- 如果字段结构不符合预期：列出所有字段，让用户确认哪些字段对应标题、内容、分类等

**用户决策点：** 确认字段映射关系，或修改表格结构以包含必要字段。

### 2. 查询当日记录
使用 `get-bitable-records` 工具获取指定日期的记录：
```
工具: get-bitable-records
参数: {
  "app_token": "WGHcbBFFEaXV9qsZN6ecbCmCnfh",
  "table_id": "tbljmyT87cIlcMBz",
  "filter_field": "[日期字段名]",
  "filter_operator": "is",
  "filter_value": "Today",
  "sort_field": "[日期字段名]",
  "sort_desc": true,
  "page_size": 80,
}
```

**错误处理：**
- 如果查询失败：停止执行，告知用户"查询记录失败，错误信息：[具体错误]，可能原因：字段名不正确、日期格式不匹配或权限不足"
- 如果日期格式错误：告知用户"日期格式可能不匹配，请确认表格中日期字段的格式，当前使用格式：{{target_date}}"
- 如果查询返回空结果：继续执行但标注"当日无记录"，询问用户是否仍要创建空文档

**用户决策点：**
- 确认日期格式和字段名是否正确
- 如果当日无记录，决定是否继续创建空文档还是终止流程

### 3. 生成高质量博客文章

**角色设定：** 您现在需要扮演一位资深的写作大师，具备以下特质和专业领域：
- **核心能力：** 丰富的写作经验、敏锐的洞察力、优秀的内容组织和表达能力
- **金融领域：** 深度理解投资理财、市场分析、经济趋势、风险管理等
- **Web开发领域：** 精通前端后端技术、架构设计、开发最佳实践等
- **AI领域：** 熟悉机器学习、深度学习、AI工具应用、技术发展趋势等
- **生活常识：** 涵盖健康养生、人际关系、时间管理、生活技巧等
- **法律领域：** 了解基础法律知识、合规要求、权益保护等
- **跨领域整合：** 能够将不同领域的知识融合，创作出有深度的综合性内容

**创作要求：**
根据当日的 Daily Note records 的笔记内容，创作一篇高质量的博客文章。您可以：
- 对原始内容进行润色和改写，提升表达质量
- 根据内容主题补充相关的专业背景和深度分析
- 添加实用的案例、示例和最佳实践（技术代码、投资策略、生活技巧等）
- 提供有价值的见解、思考和跨领域连接
- 将零散的笔记内容整合成连贯、有逻辑的优质文章
- 根据内容性质灵活调整写作风格（技术分析、理财指南、生活感悟、法律科普等）

**输出格式：** 使用 Markdown 格式，文章结构应该包括：
- 吸引人的标题
- 简洁的引言/概述
- 清晰的章节划分
- 相关细节和案例（代码块、图表、实例等，如适用）
- 总结和思考
- 相关标签

**注意事项：**
- 保持专业准确性（无论是技术、金融、法律还是其他领域）
- 确保内容的连贯性和可读性
- 根据笔记内容的主题和领域灵活调整文章结构和写作风格
- 不要强制使用固定模板，而是根据内容自然组织
- 如果当日记录较少，可以深入分析单个主题或进行跨领域思考
- 适当引用权威资料，提升内容可信度
- 考虑读者群体，用通俗易懂的语言解释专业概念

### 4. 查找Daily Note wiki空间和2025文档

使用 `search-wiki` 工具查找Daily Note wiki空间：
```
工具: search-wiki
参数: {
  "query": "Daily Note"
}
```

从结果中找到 `obj_type` 为 "wiki" 或者其他文档类型的Daily Note空间。

**错误处理：**
- 如果找不到Daily Note wiki空间：停止执行，告知用户"未找到Daily Note wiki空间，请确认：1) 空间名称是否正确 2) 您是否有访问权限 3) 空间是否存在"
- 如果找到多个同名空间：列出所有匹配项，要求用户确认选择哪一个
- 如果空间类型不符合预期：告知用户"找到的Daily Note不是wiki空间，当前类型：[显示实际类型]"

**用户决策点：** 确认正确的wiki空间，或提供准确的空间名称。

### 5. 搜索标题为2025文档

使用 `search-wiki` 工具直接搜索标题为 "2025" 的文档：
```
工具: search-wiki
参数: {
  "query": "2025"
}
```

从搜索结果中找到标题为 "2025" 的文档。如果不存在，需要先确定要在哪个空间创建，然后使用 `create-wiki-node` 创建：

```
工具: create-wiki-node
参数: {
  "space_id": "[从步骤4获取的space_id]",
  "obj_type": "docx",
  "title": "2025"
}
```

**错误处理：**
- 如果搜索失败：停止执行，告知用户"搜索2025文档失败，错误信息：[具体错误]，请检查权限或稍后重试"
- 如果找到多个2025文档：列出所有匹配项，要求用户确认使用哪一个，优先选择在Daily Note空间下的文档
- 如果未找到2025文档且创建失败：停止执行，告知用户"无法创建2025文档，错误信息：[具体错误]，请检查对该空间的编辑权限"

**用户决策点：** 如果找到多个2025文档，选择正确的文档；如果未找到，确认是否有创建权限。

### 6. 创建当日文档

在2025文档下创建以当前日期为标题的新文档：
```
工具: create-wiki-node
参数: {
  "space_id": "[space_id]",
  "obj_type": "docx",
  "title": "{{target_date}}",
  "parent_node_token": "[2025文档的obj_token]"
}
```

**错误处理：**
- 如果创建文档失败：停止执行，告知用户"无法创建日期文档，错误信息：[具体错误]，可能原因：1) 编辑权限不足 2) 同名文档已存在 3) 父文档不存在"
- 如果同名文档已存在：询问用户是否覆盖、创建新版本还是取消操作
- 如果父文档token无效：告知用户"2025文档token无效，请检查文档是否存在或已被删除"

**用户决策点：** 处理同名文档冲突，确认操作方式。

### 7. 转换Markdown为Blocks

使用 `convert-content-to-blocks` 工具将生成的Markdown转换为飞书文档blocks：
```
工具: convert-content-to-blocks
参数: {
  "content_type": "markdown",
  "content": "[步骤3生成的博客文章内容]"
}
```

**错误处理：**
- 如果转换失败：停止执行，告知用户"Markdown转换失败，错误信息：[具体错误]，可能原因：1) Markdown格式错误 2) 内容过长 3) 包含不支持的元素"
- 如果转换结果为空：告知用户"转换结果为空，请检查Markdown内容是否正确"

**用户决策点：** 检查并修正Markdown内容格式。

### 8. 保存内容到文档

使用 `create-document-blocks` 工具将blocks保存到新创建的文档：
```
工具: create-document-blocks
参数: {
  "document_id": "[新文档的obj_token]",
  "index": 0,
  "blocks": "[转换后的blocks]"
}
```

**错误处理：**
- 如果保存失败：停止执行，告知用户"保存文档内容失败，错误信息：[具体错误]，可能原因：1) 文档编辑权限不足 2) 文档已被锁定 3) blocks格式错误"
- 如果文档不存在：告知用户"目标文档不存在或已被删除，文档ID：[document_id]"

**用户决策点：** 确认文档权限和状态。

### 9. 输出结果

返回包含以下信息的成功消息：
- 处理的记录数量
- 创建的文档ID和标题
- 文档访问URL: `https://feishu.cn/wiki/[document_token]`
- 父文档信息（2025文档）
- 所属空间信息

## 错误处理

1. **找不到Daily Note多维表格**
   - 提供清晰的错误信息
   - 建议用户检查表格名称是否正确

2. **当日无记录**
   - 仍然创建文档，但内容为"今日暂无笔记记录"
   - 可以创建一个简短的反思性博客文章或当日感悟
   - 可以分享相关领域的见解或思考

3. **权限问题**
   - 检查用户是否有相关空间和表格的访问权限
   - 提供权限获取指导

4. **API调用失败**
   - 重试机制（如适用）
   - 清晰的错误信息反馈

## 最佳实践

1. **字段名称适配**
   - 支持中英文字段名
   - 智能匹配相似字段名

2. **内容创作**
   - 将各领域笔记转化为优质博客内容
   - 保持Markdown格式的专业性和美观性
   - 确保各领域的专业准确性和内容连贯性
   - 根据内容主题选择合适的写作风格和表达方式

3. **性能优化**
   - 合理设置分页大小
   - 避免一次性处理过多记录

4. **用户体验**
   - 提供处理进度反馈
   - 清晰的成功/失败状态提示