---
alwaysApply: false
---

# MCP Server å¿«é€Ÿç”Ÿæˆè§„åˆ™

è¿™ä¸ªè§„åˆ™ç”¨äºå¿«é€Ÿåˆ›å»ºæ ‡å‡†çš„ MCP (Model Context Protocol) Server é¡¹ç›®ç»“æ„ï¼Œæ”¯æŒ tools å’Œ prompts åŠŸèƒ½ï¼Œä»¥åŠ CLI å®‰è£…åŠŸèƒ½ã€‚

åˆ‡è®°ä¸è¦ç”Ÿæˆä»»ä½•åŠŸèƒ½,åˆ‡è®°ä¸è¦ç”Ÿæˆä»»ä½•åŠŸèƒ½,åˆ‡è®°ä¸è¦ç”Ÿæˆä»»ä½•åŠŸèƒ½

## ä½¿ç”¨æ–¹æ³•

å½“ç”¨æˆ·è¯·æ±‚åˆ›å»ºæ–°çš„ MCP server æ—¶ï¼ŒæŒ‰ç…§ä»¥ä¸‹ç›®å½•ç»“æ„å’Œæ–‡ä»¶æ¨¡æ¿è¿›è¡Œåˆ›å»º.

## é¡¹ç›®ç»“æ„

```
packages/{server-name}/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts                 # ä¸»å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ cli.ts                   # CLI å‘½ä»¤è¡Œå·¥å…·
â”‚   â”œâ”€â”€ tools/                   # å·¥å…·å‡½æ•°ç›®å½•
â”‚   â”‚   â””â”€â”€ example.ts           # ç¤ºä¾‹å·¥å…·æ–‡ä»¶
â”‚   â”œâ”€â”€ prompts/                 # æç¤ºè¯ç›®å½•
â”‚   â”‚   â””â”€â”€ example.ts           # ç¤ºä¾‹æç¤ºè¯æ–‡ä»¶
â”‚   â””â”€â”€ client.ts                # å®¢æˆ·ç«¯æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ tests/                       # æµ‹è¯•ç›®å½•
â”‚   â””â”€â”€ index.test.ts            # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ package.json                 # åŒ…é…ç½®æ–‡ä»¶
â”œâ”€â”€ tsconfig.json               # TypeScript é…ç½®
â”œâ”€â”€ vitest.config.ts            # æµ‹è¯•é…ç½®
â””â”€â”€ README.md                   # æ–‡æ¡£è¯´æ˜
```

## æ–‡ä»¶æ¨¡æ¿

### package.json æ¨¡æ¿
```json
{
  "name": "@mcp-servers/{server-name}",
  "version": "0.1.0",
  "description": "{Server Description}",
  "type": "module",
  "main": "src/index.ts",
  "bin": {
    "{server-name}-mcp": "src/cli.ts"
  },
  "files": [
    "src"
  ],
  "scripts": {
    "test": "vitest",
    "inspector": "pnpx @modelcontextprotocol/inspector tsx src/index.ts",
    "dev": "tsx src/index.ts",
    "cli": "tsx src/cli.ts",
    "postinstall": "pnpm link --global"
  },
  "keywords": [
    "mcp",
    "typescript"
  ],
  "author": "MCP Servers Team",
  "license": "MIT",
  "dependencies": {
    "@mcp-servers/core": "workspace:*",
    "@modelcontextprotocol/sdk": "catalog:",
    "commander": "catalog:",
    "dotenv": "^16.5.0",
    "zod": "catalog:"
  },
  "devDependencies": {
    "@types/node": "^20.0.0",
    "tsx": "^4.19.4",
    "typescript": "^5.8.2",
    "vitest": "^3.0.9"
  },
  "engines": {
    "node": ">=18"
  }
}
```

### src/index.ts æ¨¡æ¿
```typescript
import { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';
import { StdioServerTransport } from '@modelcontextprotocol/sdk/server/stdio.js';
import { registerExampleTool } from './tools/example.js';
import { registerExamplePrompt } from './prompts/example.js';

async function main() {
  // Create an MCP server
  const server = new McpServer(
    {
      name: '{Server Name}',
      version: '1.0.0',
    },
    {
      capabilities: {
        tools: {},
        prompts: {},
      },
    },
  );

  // Add tools
  registerExampleTool(server);

  // Add prompts
  registerExamplePrompt(server);

  // Start receiving messages on stdin and sending messages on stdout
  const transport = new StdioServerTransport();
  await server.connect(transport);
}

main().catch(console.error);
```

### src/cli.ts æ¨¡æ¿
```typescript
#!/usr/bin/env -S pnpm tsx

import { Command } from 'commander';
import { createInstallCommand } from '@mcp-servers/core';
import path from 'path';
import { fileURLToPath } from 'url';

const program = new Command();

program
  .name('{server-name}-mcp')
  .description('CLI for {Server Name} MCP Server')
  .version('0.1.0');

const entryPath = path.resolve(path.dirname(fileURLToPath(import.meta.url)), 'index.ts');
const installCommand = createInstallCommand({
  name: '{server-name}-mcp',
  entryPath: entryPath,
  beforeInstall: async (options) => {
    console.log('ğŸ”§ Installing {Server Name} MCP Server...');
    console.log(`Client: ${options.client}, Global: ${options.global}`);
    
    // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ å®‰è£…å‰çš„éªŒè¯é€»è¾‘
    console.log('âœ… å®‰è£…å‰æ£€æŸ¥å®Œæˆ');
    return true;
  },
});
program.addCommand(installCommand);

program.parse();
```

### src/tools/example.ts æ¨¡æ¿
```typescript
import { z } from 'zod';
import type { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';

const exampleToolSchema = z.object({
  // å®šä¹‰å·¥å…·å‚æ•°ç»“æ„
  parameter: z.string().describe('ç¤ºä¾‹å‚æ•°'),
});

export function registerExampleTool(server: McpServer) {
  server.tool(
    '{tool-name}',
    '{tool description}',
    exampleToolSchema.shape,
    async (request) => {
      try {
        // å®ç°å·¥å…·é€»è¾‘
        const { parameter } = request.params;
        
        return {
          content: [
            {
              type: 'text',
              text: `Tool execution result with parameter: ${parameter}`,
            },
          ],
        };
      } catch (error) {
        return {
          content: [
            {
              type: 'text',
              text: `Error: ${error instanceof Error ? error.message : String(error)}`,
            },
          ],
          isError: true,
        };
      }
    },
  );
}
```

### src/prompts/example.ts æ¨¡æ¿
```typescript
import { z } from 'zod';
import type { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';

const examplePromptSchema = z.object({
  // å®šä¹‰æç¤ºè¯å‚æ•°ç»“æ„
  context: z.string().describe('ä¸Šä¸‹æ–‡ä¿¡æ¯'),
  style: z.enum(['formal', 'casual', 'technical']).optional().describe('å†™ä½œé£æ ¼'),
});

export function registerExamplePrompt(server: McpServer) {
  server.prompt(
    '{prompt-name}',
    '{prompt description}',
    examplePromptSchema.shape,
    async (request) => {
      try {
        const { context, style = 'formal' } = request.params;
        
        // æ ¹æ®å‚æ•°ç”Ÿæˆæç¤ºè¯
        let promptText = `åŸºäºä»¥ä¸‹ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼š${context}\n\n`;
        
        switch (style) {
          case 'casual':
            promptText += 'è¯·ç”¨è½»æ¾å‹å¥½çš„è¯­æ°”å›ç­”ã€‚';
            break;
          case 'technical':
            promptText += 'è¯·ç”¨ä¸“ä¸šçš„æŠ€æœ¯æœ¯è¯­å›ç­”ã€‚';
            break;
          default:
            promptText += 'è¯·ç”¨æ­£å¼çš„è¯­æ°”å›ç­”ã€‚';
        }
        
        return {
          content: [
            {
              type: 'text',
              text: promptText,
            },
          ],
        };
      } catch (error) {
        return {
          content: [
            {
              type: 'text',
              text: `Error: ${error instanceof Error ? error.message : String(error)}`,
            },
          ],
          isError: true,
        };
      }
    },
  );
}
```

### tsconfig.json æ¨¡æ¿
```json
{
  "extends": "../../tsconfig.json",
  "include": ["src/**/*", "tests/**/*"]
}
```

### vitest.config.ts æ¨¡æ¿
```typescript
import { defineConfig } from 'vitest/config';

export default defineConfig({
  test: {
    environment: 'node',
  },
});
```

### README.md æ¨¡æ¿
```markdown
# {Server Name} MCP Server

{Server Description}

## Installation

Install the MCP server to your MCP client:

```bash
# Install globally
{server-name}-mcp install -c cursor -g

# Install for current project
{server-name}-mcp install -c cursor
```

## Usage

Use the MCP inspector to test this server:

```bash
pnpm inspector
```

## CLI Commands

- `install`: Install MCP server to your MCP client
  - `-c, --client <client>`: Target MCP client (cursor, gemini-cli)
  - `-g, --global`: Install globally (optional)

## Tools

- `{tool-name}`: {tool description}

## Prompts

- `{prompt-name}`: {prompt description}
```

## è§„åˆ™è¦ç‚¹

1. **ä½¿ç”¨ pnpm åŒ…ç®¡ç†å™¨**: æ‰€æœ‰å‘½ä»¤ä½¿ç”¨ `pnpm` è€Œä¸æ˜¯ `npm` æˆ– `yarn`
2. **Monorepo ç»“æ„**: æ‰€æœ‰ MCP server æ”¾åœ¨ `packages/` ç›®å½•ä¸‹
3. **TypeScript æ”¯æŒ**: æ‰€æœ‰æ–‡ä»¶ä½¿ç”¨ TypeScript
4. **æ ‡å‡†åŒ–å‘½å**: 
   - åŒ…åä½¿ç”¨ kebab-case: `example-mcp`
   - CLI å‘½ä»¤åä½¿ç”¨ kebab-case: `example-mcp`
   - å·¥å…·åä½¿ç”¨ kebab-case: `example-tool`
   - æç¤ºè¯åä½¿ç”¨ kebab-case: `example-prompt`
   - æ–‡ä»¶åä½¿ç”¨ camelCase: `exampleTool.ts`, `examplePrompt.ts`
5. **ä¾èµ–ç®¡ç†**: 
   - ä½¿ç”¨ catalog æ¨¡å¼ç®¡ç†é€šç”¨ä¾èµ–ç‰ˆæœ¬
   - MCP SDK ç‰ˆæœ¬ç»Ÿä¸€ç®¡ç†
   - ä¾èµ– `@mcp-servers/core` è·å– install å‘½ä»¤åŠŸèƒ½
6. **æµ‹è¯•æ”¯æŒ**: æ¯ä¸ª MCP server éƒ½åŒ…å« vitest æµ‹è¯•é…ç½®
7. **å¼€å‘å·¥å…·**: åŒ…å« inspector è„šæœ¬ç”¨äºè°ƒè¯•
8. **CLI åŠŸèƒ½**: 
   - æä¾›æ ‡å‡†çš„ install å‘½ä»¤
   - æ”¯æŒå…¨å±€å’Œé¡¹ç›®çº§åˆ«å®‰è£…
   - æ”¯æŒ Cursor å’Œ Gemini CLI å®¢æˆ·ç«¯
9. **åŠŸèƒ½æ”¯æŒ**: 
   - æ”¯æŒ tools åŠŸèƒ½ï¼šæä¾›å¯è°ƒç”¨çš„å·¥å…·å‡½æ•°
   - æ”¯æŒ prompts åŠŸèƒ½ï¼šæä¾›åŠ¨æ€ç”Ÿæˆçš„æç¤ºè¯æ¨¡æ¿
10. **é”™è¯¯å¤„ç†**: æ‰€æœ‰å·¥å…·å’Œæç¤ºè¯éƒ½åŒ…å«å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶
11. **å‚æ•°éªŒè¯**: ä½¿ç”¨ zod è¿›è¡Œå‚æ•°éªŒè¯å’Œç±»å‹å®‰å…¨

## ç”Ÿæˆæ­¥éª¤

å½“åˆ›å»ºæ–°çš„ MCP server æ—¶ï¼š

1. åœ¨ `packages/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„æœåŠ¡å™¨ç›®å½•
2. æ ¹æ®æ¨¡æ¿åˆ›å»ºæ‰€æœ‰å¿…è¦æ–‡ä»¶
3. å°† `{server-name}` ç­‰å ä½ç¬¦æ›¿æ¢ä¸ºå®é™…å€¼
4. æ ¹æ®éœ€æ±‚é€‰æ‹©æ€§åœ°å®ç° tools å’Œ prompts åŠŸèƒ½
5. æç¤ºç”¨æˆ·è¿è¡Œ `pnpm install` å®‰è£…ä¾èµ–
6. æç¤ºç”¨æˆ·å¯ä»¥ä½¿ç”¨ `pnpm inspector` æµ‹è¯•æœåŠ¡å™¨
7. æç¤ºç”¨æˆ·å¯ä»¥ä½¿ç”¨ CLI å‘½ä»¤å®‰è£…åˆ° MCP å®¢æˆ·ç«¯

## åŠŸèƒ½é€‰æ‹©

æ ¹æ® MCP server çš„å…·ä½“éœ€æ±‚ï¼Œå¯ä»¥é€‰æ‹©å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š

- **ä»… Tools**: åªå®ç°å·¥å…·åŠŸèƒ½ï¼Œç”¨äºæä¾›å¯è°ƒç”¨çš„ API
- **ä»… Prompts**: åªå®ç°æç¤ºè¯åŠŸèƒ½ï¼Œç”¨äºæä¾›åŠ¨æ€æç¤ºè¯æ¨¡æ¿
- **Tools + Prompts**: åŒæ—¶å®ç°å·¥å…·å’Œæç¤ºè¯åŠŸèƒ½ï¼Œæä¾›å®Œæ•´çš„ MCP æœåŠ¡
- **CLI å®‰è£…**: æä¾›æ ‡å‡†çš„ install å‘½ä»¤ï¼Œæ”¯æŒå®‰è£…åˆ°å„ç§ MCP å®¢æˆ·ç«¯

## CLI å‘½ä»¤è¯´æ˜

### install å‘½ä»¤

`install` å‘½ä»¤ç”¨äºå°† MCP server å®‰è£…åˆ°æŒ‡å®šçš„ MCP å®¢æˆ·ç«¯ï¼š

```bash
{server-name}-mcp install -c <client> [-g]
```

**å‚æ•°è¯´æ˜ï¼š**
- `-c, --client <client>`: ç›®æ ‡ MCP å®¢æˆ·ç«¯ï¼Œæ”¯æŒï¼š
  - `cursor`: Cursor ç¼–è¾‘å™¨
  - `gemini-cli`: Gemini CLI
- `-g, --global`: å¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºå…¨å±€å®‰è£…

**å®‰è£…ä½ç½®ï¼š**
- å…¨å±€å®‰è£…ï¼šç”¨æˆ·ä¸»ç›®å½•ä¸‹çš„å®¢æˆ·ç«¯é…ç½®ç›®å½•
- é¡¹ç›®å®‰è£…ï¼šå½“å‰é¡¹ç›®ç›®å½•ä¸‹çš„å®¢æˆ·ç«¯é…ç½®ç›®å½•

**æ”¯æŒçš„å®¢æˆ·ç«¯ï¼š**
- **Cursor**: é…ç½®æ–‡ä»¶ä½äº `~/.cursor/mcp.json` æˆ– `./.cursor/mcp.json`
- **Gemini CLI**: é…ç½®æ–‡ä»¶ä½äº `~/.gemini/settings.json` æˆ– `./.gemini/settings.json`

è¿™ä¸ªè§„åˆ™ç¡®ä¿æ‰€æœ‰ MCP server éƒ½éµå¾ªç»Ÿä¸€çš„ç»“æ„å’Œæœ€ä½³å®è·µï¼ŒåŒæ—¶æ”¯æŒç°ä»£ MCP åè®®çš„æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ï¼Œå¹¶æä¾›ä¾¿æ·çš„ CLI å®‰è£…å·¥å…·ã€‚
